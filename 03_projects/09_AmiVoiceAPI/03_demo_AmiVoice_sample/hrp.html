<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<title>AmiVoiceを体験してみよう</title>
<script type="text/javascript" src="recorder.js"></script>
<script type="text/javascript" src="hrp.js"></script>
<style type="text/css">
table {table-layout: fixed;}
td {font-size: 14px; border: 1px solid #000;}
.text {font-size: 14px; font-family: inconsolata, consolas, monospace; width: 100%; height: 21px; margin: 0; padding: 2px; border: none; box-sizing: border-box;}
#messages div {
  padding: 3px 0;
  font-family: monospace;
}
#issueButton {
  height: 100%;
  cursor: pointer;
}
#audio {
  cursor: pointer;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
#sendButton {
  height: 100%;
  cursor: pointer;
}
#recognitionResult {
  padding: 3px;
  font-size: 24px;
}
.dropping {
  background: #f8d0e0 !important;
  border-color: #f090d0 !important;
}
.sending {
  color: white;
  background: red;
}
.supplement {
  font-size: 12px;
}
.bar {
  position: relative;
}
#version {
  font-size: 10px;
  foreground: lightgrey;
  position: absolute;
  right: 0;
  top: -12px;
}
</style>
</head>
<body lang="ja">
<form>
<h1>AmiVoiceを体験してみよう</h1>
<p>
  利用にあたっては、「１．入力」「２．入力」「３．クリック」「４．確認」「５．指定」「６．クリック」の手順で進めてください。
</p>
<table border="0" width="100%" cellspacing="3" cellpadding="0">
  <tr><td width="240">&nbsp;発行者 URL</td><td><input type="text" class="text" id="issuerURL" spellcheck="false" tabindex="1"></td></tr>
  <tr><td width="240">&nbsp;１．サービス ID</td><td><input type="text" class="text" id="sid" spellcheck="false" tabindex="1"></td></tr>
  <tr><td width="240">&nbsp;２．サービスパスワード</td><td><input type="password" class="text" id="spw" spellcheck="false" autocomplete="on" tabindex="1"></td></tr>
  <tr class="issue_options" style="display:none;"><td width="240">&nbsp;有効期限</td><td><input type="text" class="text" id="epi" spellcheck="false" tabindex="1"></td></tr>
  <tr>
    <td width="240" height="32">
      <input type="button" value="３．サービス認証キーの取得" class="text" id="issueButton" tabindex="2">
    </td>
    <td>
      &nbsp;
    </td>
  </tr>
  <tr><td width="240">&nbsp;サーバ URL</td><td><input type="text" class="text" id="serverURL" spellcheck="false" tabindex="3"></td></tr>
  <tr><td width="240">&nbsp;グラマファイル名</td><td><input type="text" class="text" id="grammarFileNames" spellcheck="false" tabindex="3"></td></tr>
  <tr class="options" style="display:none;"><td width="240">&nbsp;モード</td><td><input type="text" class="text" id="mode" spellcheck="false" tabindex="3"></td></tr>
  <tr ><td width="240">&nbsp;プロファイル ID</td><td><input type="text" class="text" id="profileId" spellcheck="false" tabindex="3"></td></tr>
  <tr class="options" style="display:none;"><td width="240">&nbsp;プロファイル単語</td><td><input type="text" class="text" id="profileWords" spellcheck="false" tabindex="3"></td></tr>
  <tr class="options" style="display:none;"><td width="240">&nbsp;<font color="silver">セグメンタタイプ</font></td><td><input type="text" class="text" id="segmenterType" spellcheck="false" tabindex="3"></td></tr>
  <tr class="options" style="display:none;"><td width="240">&nbsp;<font color="silver">セグメンタプロパティ文字列</font></td><td><input type="text" class="text" id="segmenterProperties" spellcheck="false" tabindex="3"></td></tr>
  <tr class="options" style="display:none;"><td width="240">&nbsp;認識中イベント発行間隔 (単位：ミリ秒)</td><td><input type="text" class="text" id="resultUpdatedInterval" spellcheck="false" tabindex="3"></td></tr>
  <tr class="options" style="display:none;"><td width="240">&nbsp;拡張情報</td><td><input type="text" class="text" id="extension" spellcheck="false" tabindex="3"></td></tr>
  <tr class="options" style="display:none;"><td width="240">&nbsp;<font color="silver">サービス認証キー</font></td><td><input type="text" class="text" id="authorization" spellcheck="false" tabindex="3"></td></tr>
  <tr class="options" style="display:none;"><td width="240">&nbsp;音声データ形式</td><td><input type="text" class="text" id="codec" spellcheck="false" tabindex="3"></td></tr>
  <tr class="options" style="display:none;"><td width="240">&nbsp;認識結果タイプ</td><td><input type="text" class="text" id="resultType" spellcheck="false" tabindex="3"></td></tr>
  <tr class="options" style="display:none;"><td width="240">&nbsp;<font color="silver">認識結果文字エンコーディング</font></td><td><input type="text" class="text" id="resultEncoding" spellcheck="false" tabindex="3"></td></tr>
  <tr><td width="240">&nbsp;４．サービス認証キー</td><td><input type="text" class="text" id="serviceAuthorization" spellcheck="false" tabindex="3"></td></tr>
  <tr class="options" style="display:none;"><td width="240">&nbsp;発話区間検出パラメータ情報</td><td><input type="text" class="text" id="voiceDetection" spellcheck="false" tabindex="3"></td></tr>
  <tr class="options" style="display:none;"><td width="240">&nbsp;連続録音可能時間 (単位: ミリ秒)</td><td><input type="text" class="text" id="maxRecordingTime" spellcheck="false" tabindex="3"></td></tr>
  <tr><td width="240">&nbsp;５．(音声データ)</td><td><div id="audio" class="text" tabindex="4"></div></td></tr>
  <tr><td width="240" height="32"><button class="text" id="sendButton" tabindex="2">&nbsp;６．音声データの送信※</span></button></td><td id="recognitionResult"></td></tr>
</table>
<br>
<p>
  <b>手順説明：</b>
  <ul>
    <li>「１．サービス ID」入力※</li>
    <li>「２．サービスパスワード」入力※</li>
    <li>「３．サービス認証キーの取得」クリック</li>
    <li>「４．サービス認証キー」が表示もしくは更新されるのを確認</li>
    <p>
      「サービス ID」「サービスパスワード」の入力後、<b>[サービス認証キーの取得]</b> ボタンを押すと、「サービス認証キー」に認証キーが表示されます。<br>
      ※サービス ID、サービスパスワードは、<a href="https://acp.amivoice.com/account/login.php" target="_blank">AmiVoice Cloud Platformのサイト</a>（マイページ）に記載されてます（登録必要）。
    </p>
    <li>「５．(音声データ)」指定（「ここをクリック...」から音声ファイルを指定</li>
    <li>「６．音声データの送信」クリック</li>
    <li>「６．音声データの送信」の右欄にテキストが表示されます</li>
  </ul>
<b>※音声データファイルから音声を入力する場合...</b><br>
(音声データ) の入力フィールドをクリックして音声データファイルを選択するか、音声データファイルをブラウザ上に直接ドラッグ＆ドロップした後に <b>[音声データの送信]</b> ボタンを押してください<span class="toggle_options">。</span><br>
</p>
<br>
<div class="bar"><hr><div id="version"></div></div>
<div id="messages"></div>
<script type="text/javascript">
(function() {
  // <!--
  function log_(s) {
    console.log(s);
    var color = "";
    if (s.lastIndexOf("EVENT: ", 0) != -1) {
//    color = "green";
    } else
    if (s.lastIndexOf("INFO: ", 0) != -1) {
//    color = "blue";
    } else
    if (s.lastIndexOf("ERROR: ", 0) != -1) {
      color = "red";
    } else {
      color = "black";
    }
    if (color) {
      if (messages.childNodes.length >= 20) {
        messages.removeChild(messages.lastChild);
      }
      messages.insertBefore(document.createElement("div"), messages.firstChild).innerHTML = s;
      messages.firstChild.style.borderBottom = "1px #ddd solid";
      messages.firstChild.style.color = color;
    }
  }
  function sanitize_(s) {
    return s.replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/'/g, '&apos;')
            .replace(/"/g, '&quot;');
  }
  var buffer;
  var bufferEnding;
  function append_(item) {
    if (item.length == 0) {
      return;
    }
    if (item == "<->") {
      return;
    }
    var itemState = 0;
    for (var i = 0; i < item.length; i++) {
      var c = item.charCodeAt(i);
      if (itemState == 0) {
        if (c == 0x005F) {
          break;
        } else
        if (c == 0x4E00 || c == 0x4E8C || c == 0x4E09 || c == 0x56DB || c == 0x4E94 || c == 0x516D || c == 0x4E03 || c == 0x516B || c == 0x4E5D) { // '一'～'九'
          itemState = 1;
        } else
        if (c == 0x5341) { // '十'
          itemState = 2;
        } else
        if (c == 0x767E) { // '百'
          itemState = 4;
        } else
        if (c == 0x5343) { // '千'
          itemState = 8;
        } else {
          break;
        }
      } else {
        if (c == 0x005F) {
          item = item.substr(0, i) + item.substr(i + 1);
          break;
        } else
        if (c == 0x4E00 || c == 0x4E8C || c == 0x4E09 || c == 0x56DB || c == 0x4E94 || c == 0x516D || c == 0x4E03 || c == 0x516B || c == 0x4E5D) { // '一'～'九'
          if ((itemState & 1) != 0) {
            break;
          } else {
            itemState |= 1;
          }
        } else
        if (c == 0x5341) { // '十'
          if ((itemState & 2) != 0) {
            break;
          } else {
            itemState |= 2;
            itemState &= ~1;
          }
        } else
        if (c == 0x767E) { // '百'
          if ((itemState & 6) != 0) {
            break;
          } else {
            itemState |= 4;
            itemState &= ~1;
          }
        } else
        if (c == 0x5343) { // '千'
          if ((itemState & 14) != 0) {
            break;
          } else {
            itemState |= 8;
            itemState &= ~1;
          }
        } else {
          break;
        }
      }
    }
    item = item.replace(/_/g, " ");
    var itemBeginningChar = item.charCodeAt(0);
    var itemEndingChar = (item.length > 1) ? item.charCodeAt(item.length - 1) : 0;
    if (bufferEnding == 0) {
      var itemBeginning;
      var c = itemBeginningChar;
      if (c == 0x0020) {
        itemBeginning = 0;
      } else
      if (c == 0x0021
       || c == 0x002C
       || c == 0x002E
       || c == 0x003A
       || c == 0x003B
       || c == 0x003F) {
        itemBeginning = 5;
      } else
      if (c == 0x3001
       || c == 0x3002
       || c == 0xFF01
       || c == 0xFF0C
       || c == 0xFF0E
       || c == 0xFF1A
       || c == 0xFF1B
       || c == 0xFF1F) {
        itemBeginning = 6;
      } else {
        itemBeginning = 7;
      }
      if (itemBeginning == 0
       || itemBeginning == 5
       || itemBeginning == 6) {
        if (buffer.length > 0) {
          buffer = buffer.substr(0, buffer.length - 1);
        }
      }
    } else {
      var itemBeginning;
      var c = itemBeginningChar;
      if (c == 0x0020) {
        itemBeginning = 0;
      } else
      if (c >= 0x0041 && c <= 0x005A
       || c >= 0x0061 && c <= 0x007A
       || c >= 0x0100 && c <= 0x0DFF
       || c >= 0x0E60 && c <= 0x01FF) {
        itemBeginning = 1;
      } else
      if (c >= 0xFF21 && c <= 0xFF3A
       || c >= 0xFF41 && c <= 0xFF5A) {
        itemBeginning = 2;
      } else
      if (c >= 0x0030 && c <= 0x0039) {
        itemBeginning = (bufferEnding == 8 && itemEndingChar == 0) ? 8 : 3;
      } else
      if (c >= 0xFF10 && c <= 0xFF19) {
        itemBeginning = (bufferEnding == 9 && itemEndingChar == 0) ? 9 : 4;
      } else
      if (c == 0x0021
       || c == 0x002C
       || c == 0x002E
       || c == 0x003A
       || c == 0x003B
       || c == 0x003F) {
        itemBeginning = 5;
      } else
      if (c == 0x3001
       || c == 0x3002
       || c == 0xFF01
       || c == 0xFF0C
       || c == 0xFF0E
       || c == 0xFF1A
       || c == 0xFF1B
       || c == 0xFF1F) {
        itemBeginning = 6;
      } else {
        itemBeginning = 7;
      }
      if (itemBeginning == 1 || bufferEnding == 1 && (itemBeginning == 2
                                                   || itemBeginning == 3
                                                   || itemBeginning == 4
                                                   || itemBeginning == 7)
                             || bufferEnding == 2 && (itemBeginning == 2)
                             || bufferEnding == 3 && (itemBeginning == 3
                                                   || itemBeginning == 4)
                             || bufferEnding == 4 && (itemBeginning == 3
                                                   || itemBeginning == 4)
                             || bufferEnding == 5 && (itemBeginning == 2
                                                   || itemBeginning == 3
                                                   || itemBeginning == 4
                                                   || itemBeginning == 7)
                             || bufferEnding == 8 && (itemBeginning == 3
                                                   || itemBeginning == 4)
                             || bufferEnding == 9 && (itemBeginning == 3
                                                   || itemBeginning == 4)) {
        buffer += " ";
      }
    }
    buffer += item;
    c = (itemEndingChar == 0) ? itemBeginningChar : itemEndingChar;
    if (c == 0x0020) {
      bufferEnding = 0;
    } else
    if (c >= 0x0041 && c <= 0x005A
     || c >= 0x0061 && c <= 0x007A
     || c >= 0x0100 && c <= 0x0DFF
     || c >= 0x0E60 && c <= 0x01FF) {
      bufferEnding = 1;
    } else
    if (c >= 0xFF21 && c <= 0xFF3A
     || c >= 0xFF41 && c <= 0xFF5A) {
      bufferEnding = 2;
    } else
    if (c >= 0x0030 && c <= 0x0039) {
      bufferEnding = (itemEndingChar == 0) ? 8 : 3;
    } else
    if (c >= 0xFF10 && c <= 0xFF19) {
      bufferEnding = (itemEndingChar == 0) ? 9 : 4;
    } else
    if (c == 0x0021
     || c == 0x002C
     || c == 0x002E
     || c == 0x003A
     || c == 0x003B
     || c == 0x003F) {
      bufferEnding = 5;
    } else
    if (c == 0x3001
     || c == 0x3002
     || c == 0xFF01
     || c == 0xFF0C
     || c == 0xFF0E
     || c == 0xFF1A
     || c == 0xFF1B
     || c == 0xFF1F) {
      bufferEnding = 6;
    } else {
      bufferEnding = 7;
    }
  }
  // -->
  // 音声認識サーバへの音声データの供給開始処理が開始した時に呼び出されます。
  function feedDataResumeStarted() {
    log_("EVENT: feedDataResumeStarted()");
    // ボタンの制御
    sendButton.disabled = true;
  }

  // 音声認識サーバへの音声データの供給開始処理が完了した時に呼び出されます。
  function feedDataResumeEnded() {
    log_("EVENT: feedDataResumeEnded()");
    // ボタンの制御
    sendButton.innerHTML = "<br><br>音声データの録音中...<br><br><span class=\"supplement\">クリック → 録音の停止</span>";
    sendButton.disabled = false;
    sendButton.classList.add("sending");
  }

  // 音声認識サーバへの音声データの供給終了処理が開始した時に呼び出されます。
  function feedDataPauseStarted() {
    log_("EVENT: feedDataPauseStarted()");
    // ボタンの制御
    sendButton.innerHTML = "音声データの送信中...";
    sendButton.disabled = true;
    sendButton.classList.add("sending");
  }

  // 音声認識サーバへの音声データの供給終了処理が完了した時に呼び出されます。
  function feedDataPauseEnded(reason) {
    log_("EVENT: feedDataPauseEnded(): reason[code[" + reason.code + "] message[" + reason.message + "]]");
    // 録音中かどうかのチェック
    if (Recorder.isActive()) {
      // 録音中の場合...
      // 録音の停止
      Recorder.pause();
    } else {
      // 録音中でない場合...
      // ボタンの制御
      sendButton.innerHTML = "<br><br>音声データの送信<br><br><span class=\"supplement\">Shift+クリック → 録音の開始</span>";
      sendButton.disabled = false;
      sendButton.classList.remove("sending");
    }
  }

  // 認識処理が開始された時に呼び出されます。
  function resultCreated(sessionId) {
    log_("EVENT: resultCreated(): sessionId[" + sessionId + "]");
    recognitionResult.innerHTML = "...";
  }

  // 認識処理中に呼び出されます。
  function resultUpdated(result) {
    log_("EVENT: resultUpdated(): result[" + result + "]");
    try {
      var json = JSON.parse(result);
      buffer = (json.text) ? sanitize_(json.text) : "...";
    } catch (e) {
      if (result.indexOf("\x01") == -1) {
        buffer = (result) ? sanitize_(result) : "...";
      } else {
        var fields = result.split("\x01");
        var fields0 = fields[0].split("|");
        // <!--
        buffer = "";
        bufferEnding = 0;
        // -->
        var i, j;
        for (i = 0; i < fields0.length; i++) {
          var written = fields0[i];
          if ((j = written.indexOf(" ")) != -1) {
            written = written.slice(0, j);
          }
          if ((j = written.indexOf(":")) != -1) {
            written = written.slice(0, j);
          }
          if ((j = written.indexOf("\x03")) != -1) {
            written = written.slice(0, j);
          }
          // <!--
          append_(written);
          // -->
        }
        buffer = (buffer) ? sanitize_(buffer) : "...";
      }
    }
    recognitionResult.innerHTML = buffer;
  }

  // 認識処理が確定した時に呼び出されます。
  function resultFinalized(result) {
    log_("EVENT: resultFinalized(): result[" + result + "]");
    try {
      var json = JSON.parse(result);
      buffer = (json.text) ? sanitize_(json.text) : (json.code != 'o' && json.message) ? "<font color=\"gray\">(" + json.message + ")</font>" : "<font color=\"gray\">(なし)</font>";
    } catch (e) {
      if (result.indexOf("\x01") == -1) {
        buffer = (result) ? sanitize_(result) : "<font color=\"gray\">(なし)</font>";
      } else {
        var fields = result.split("\x01");
        var fields0 = fields[0].split("|");
        // <!--
        buffer = "";
        bufferEnding = 0;
        // -->
        var i, j;
        for (i = 0; i < fields0.length; i++) {
          var written = fields0[i];
          if ((j = written.indexOf(" ")) != -1) {
            written = written.slice(0, j);
          }
          if ((j = written.indexOf(":")) != -1) {
            written = written.slice(0, j);
          }
          if ((j = written.indexOf("\x03")) != -1) {
            written = written.slice(0, j);
          }
          // <!--
          append_(written);
          // -->
        }
        buffer = (buffer) ? sanitize_(buffer) : "<font color=\"gray\">(なし)</font>";
      }
    }
    recognitionResult.innerHTML = buffer;
    log_(buffer);
  }

  // メッセージの出力が要求された時に呼び出されます。
  function TRACE(message) {
    log_(message);
  }

  // 画面要素の取得
  var issuerURL = document.getElementById("issuerURL");
  var sid = document.getElementById("sid");
  var spw = document.getElementById("spw");
  var epi = document.getElementById("epi");
  var issueButton = document.getElementById("issueButton");

  // 画面要素の初期化
  issuerURL.value = "https://acp-api.amivoice.com/issue_service_authorization";
  serverURL.value = "https://acp-api.amivoice.com/v1/recognize";
  grammarFileNames.value = "-a-general";
  mode.value = Hrp.mode;
  profileId.value = Hrp.profileId;
  profileWords.value = Hrp.profileWords;
  segmenterType.value = Hrp.segmenterType;
  segmenterProperties.value = Hrp.segmenterProperties;
  resultUpdatedInterval.value = Hrp.resultUpdatedInterval;
  extension.value = Hrp.extension;
  authorization.value = Hrp.authorization;
  codec.value = Hrp.codec;
  resultType.value = Hrp.resultType;
  resultEncoding.value = Hrp.resultEncoding;
  serviceAuthorization.value = Hrp.serviceAuthorization;
  voiceDetection.value = Hrp.voiceDetection;
  maxRecordingTime.value = Recorder.maxRecordingTime;

  // 音声認識ライブラリのプロパティ要素の設定
  Hrp.serverURLElement = serverURL;
  Hrp.grammarFileNamesElement = grammarFileNames;
  Hrp.modeElement = mode;
  Hrp.profileIdElement = profileId;
  Hrp.profileWordsElement = profileWords;
  Hrp.segmenterTypeElement = segmenterType;
  Hrp.segmenterPropertiesElement = segmenterProperties;
  Hrp.resultUpdatedIntervalElement = resultUpdatedInterval;
  Hrp.extensionElement = extension;
  Hrp.authorizationElement = authorization;
  Hrp.codecElement = codec;
  Hrp.resultTypeElement = resultType;
  Hrp.resultEncodingElement = resultEncoding;
  Hrp.serviceAuthorizationElement = serviceAuthorization;
  Hrp.voiceDetectionElement = voiceDetection;
  Hrp.audioElement = audio;
  Hrp.issuerURLElement = issuerURL;
  Hrp.sidElement = sid;
  Hrp.spwElement = spw;
  Hrp.epiElement = epi;

  // 音声認識ライブラリのイベントハンドラの設定
  Hrp.feedDataResumeStarted = feedDataResumeStarted;
  Hrp.feedDataResumeEnded = feedDataResumeEnded;
  Hrp.feedDataPauseStarted = feedDataPauseStarted;
  Hrp.feedDataPauseEnded = feedDataPauseEnded;
  Hrp.resultCreated = resultCreated;
  Hrp.resultUpdated = resultUpdated;
  Hrp.resultFinalized = resultFinalized;
  Hrp.TRACE = TRACE;

  // 録音ライブラリのプロパティ要素の設定
  Recorder.maxRecordingTimeElement = maxRecordingTime;

  // 音声認識ライブラリ／録音ライブラリのメソッドの画面要素への登録
  sendButton.onclick = function(e) {
    // 音声認識サーバへの音声データの供給中かどうかのチェック
    if (Hrp.isActive()) {
      // 音声認識サーバへの音声データの供給中の場合...
      // 音声認識サーバへの音声データの供給の停止
      Hrp.feedDataPause();
    } else {
      // 音声認識サーバへの音声データの供給中でない場合...
      // Shift キーが押されているかどうかのチェック
      if (e.shiftKey) {
        // Shift キーが押されている場合...
        // 音声認識サーバへの音声データの供給の開始
        Hrp.feedDataResume();
      } else {
        // Shift キーが押されていない場合...
        // 音声認識サーバへの音声データの供給の開始
        Hrp.feedDataResume(audio.file);
      }
    }
  };
  issueButton.onclick = Hrp.issue;

  audio.update = function(f) {
    audio.file = f || null;
    if (audio.file) {
      if (audio.file.name) {
        audio.innerHTML = sanitize_(audio.file.name) + " (" + audio.file.size + " bytes)";
      } else {
        audio.innerHTML = "[microphone device] (" + audio.file.size + " bytes) (" + (audio.file.samples / audio.file.samplesPerSec | 0) + "." +  ((audio.file.samples * 10 / audio.file.samplesPerSec | 0) % 10) + " seconds)";
      }
      audio.title = "ここをクリックして音声データファイルを選択してください。";
    } else {
      audio.innerHTML = "<font color=\"silver\">ここをクリックして音声データファイルを選択してください。</font>";
      audio.title = "";
    }
  };
  audio.input = audio.appendChild(document.createElement("input"));
  audio.input.type = "file";
  audio.input.style.display = "none";
  audio.input.onclick = function(e) {
    e.stopPropagation();
  };
  audio.input.onchange = function(e) {
    audio.update(audio.input.files && audio.input.files[0]);
  };
  audio.onclick = function(e) {
    audio.input.click();
  };
  audio.onkeyup = function(e) {
    if (e.keyCode == 13 || e.keyCode == 32) {
      audio.input.click();
    } else
    if (e.keyCode == 27) {
      this.blur();
    }
  };
  audio.update();

  var draggingTarget = null;
  var draggingState = false;
  function dragenter(e) {
    e.stopPropagation();
    e.preventDefault();
    e.dataTransfer.dropEffect = "copy";
    draggingState = false;
  }
  function dragover(e) {
    e.stopPropagation();
    e.preventDefault();
    e.dataTransfer.dropEffect = "copy";
    if (!draggingTarget) {
      draggingTarget = audio;
      draggingTarget.classList.add("dropping");
    }
    draggingState = true;
  }
  function dragleave(e) {
    e.stopPropagation();
    e.preventDefault();
    e.dataTransfer.dropEffect = "copy";
    if (draggingTarget && draggingState) {
      draggingTarget.classList.remove("dropping");
      draggingTarget = null;
    }
    draggingState = true;
  }
  function drop(e) {
    e.stopPropagation();
    e.preventDefault();
    if (draggingTarget) {
      draggingTarget.classList.remove("dropping");
      draggingTarget = null;
    }
    audio.update(e.dataTransfer.files[0]);
  }
  window.addEventListener("dragenter", dragenter);
  window.addEventListener("dragover", dragover);
  window.addEventListener("dragleave", dragleave);
  window.addEventListener("drop", drop);

  var issue_options = document.querySelectorAll(".issue_options");
  function toggle_issue_options() {
    issue_options[0].style.display = (issue_options[0].style.display === "") ? "none" : "";
    for (var i = 1; i < issue_options.length; i++) {
      issue_options[i].style.display = issue_options[0].style.display;
    }
  }
  var toggle_issue_optionss = document.querySelectorAll(".toggle_issue_options");
  for (var i = 0; i < toggle_issue_optionss.length; i++) {
    toggle_issue_optionss[i].onclick = toggle_issue_options;
    toggle_issue_optionss[i].style.cursor = "pointer";
  }

  var options = document.querySelectorAll(".options");
  function toggle_options() {
    options[0].style.display = (options[0].style.display === "") ? "none" : "";
    for (var i = 1; i < options.length; i++) {
      options[i].style.display = options[0].style.display;
    }
  }
  var toggle_optionss = document.querySelectorAll(".toggle_options");
  for (var i = 0; i < toggle_optionss.length; i++) {
    toggle_optionss[i].onclick = toggle_options;
    toggle_optionss[i].style.cursor = "pointer";
  }

  version.innerHTML = Hrp.version;
})();
</script>
</body>
</html>
